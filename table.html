2<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<meta name="google-signin-client_id" content="583488732443-0qrkltufodphbtveim4vv0nhsf5qijog.apps.googleusercontent.com">
<link rel="stylesheet" type="text/css" href="table.css">

<html>
    <head>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <script src="https://apis.google.com/js/platform.js" async defer></script>
        
        <!--<script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>-->
        
        <link href="https://fonts.googleapis.com/css?family=Alegreya|Courgette|Lobster+Two" rel="stylesheet">
        <script src="https://www.gstatic.com/firebasejs/3.4.0/firebase.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.4.0/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.4.0/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.4.0/firebase-database.js"></script>
        
        
        
        
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    </head>
    <body>
        
            <!-- Fixed navbar -->
   <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container-fluid">
        <ul class="nav navbar-nav">
          <li class="active"><a href="#">Home</a></li>
          <li><a id = "MonthSlot" href="#">Page 3</a></li>
          <li><a onclick="signOut()">Sign Out</a></li>
          <li><a onclick ="make52()">Refresh the Firebase</a></li>
          <li><a onclick = "getCurrent(1,-1)">Back</a></li>
          <li><a onclick = "getCurrent(1,1)">Forward</a></li> 
          <li><a onclick = "mineView()" >My Carts</a></li>
          <li class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" id ="floorName" href="#">Floor 1
                <span class="caret"></span>
            </a>
            <ul class="dropdown-menu" id="sel1">
              <li><a onclick="DropDown(1)">1</a></li>
              <li><a onclick="DropDown(2)">2</a></li>
              <li><a onclick="DropDown(3)">3</a></li> 
            </ul>
         </li>
        <li>
            <form class="navbar-form" role="search">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Room #" name="srch-term" id="srch-term"></input>
                    <!--<div class="input-group-btn btn btn-primary">
                    </div>-->
                </div>
                <button type = "button" class= "btn btn-primary" onclick="newRoom()">Change Room #</button>
            </form>
        </li>
        </ul>
      </div>
    </nav>
        
        
        <!-- Fixed navbar -->

    <!--<li><button type ="button" class="btn btn-primary" onclick="signOut()">Sign Out7</button></li>
          <li><button type = "button" class="btn btn-danger" onclick="make52()">Make 52</button></li>-->    
    <!--<button type ="button" class="btn btn-primary" onclick="Clear()">Clear</button>-->
    
    
    <!--<div class="container">
  <h2>Form control: select</h2>
  <p>The form below contains two dropdown menus (select lists):</p>-->
   <!--<div class="container">
      <label for="sel1">Select floor:</label>
          <select class="form-control" id="sel1">
            <option>1</option>
            <option>2</option>
            <option>3</option>
          </select>
    </div>-->
    <div class="container">
      <table class="table table-bordered"  id="myTable">
        <thead>
          <tr>
            <th>Period</th>
            <th id="monday">Monday</th>
            <th id="tuesday">Tuesday</th>
            <th id="wednesday">Wednesday</th>
            <th id="thursday">Thursday</th>
            <th id="friday">Friday</th>
          </tr>
        </thead>
        <tbody>
          <!--<tr>
            <td>1</td><td>1</td><td>1</td><td>1</td><td>1</td>
          </tr>
          <tr>
            <td>2</td><td>2</td><td>2</td><td>2</td><td>2</td>
          </tr>
          <tr>
            <td>3</td><td>3</td><td>3</td><td>3</td><td>3</td>
          </tr>
          <tr>
            <td>4</td><td>4</td><td>4</td><td>4</td><td>4</td>
          </tr>-->
        </tbody>
      </table>
      <button id = "clear" type ="button" class="btn btn-primary" onclick="Clear()">Submit</button>
    </div>
    <script>
        var personalRoom;
        var mineMode = false;
        var config = {
          apiKey: "AIzaSyB7quSFbdzOHH_S4B1TOntym_xTj4Yx6To",
          authDomain: "chrome-calendar.firebaseapp.com",
          databaseURL: "https://chrome-calendar.firebaseio.com",
          storageBucket: "chrome-calendar.appspot.com",
          messagingSenderId: "583488732443"
        };
        firebase.initializeApp(config);
        var data = localStorage.getItem('key');
                console.log("key is  " + data);
               firebase.database().ref('/users/'+data).on("value", function(snapshot) {
                  var username = snapshot.val();
                  personalRoom = username.room;
                  console.log("personal Room " + personalRoom);
                  getCurrent(0,0);
                  // ...
                });
        
        
        
        var firstGet = false;
        var already = 0;
        var callLock = 0;
        //var currentDay = 0;
        var currentMonth = 0;
        var currentDay = 1;
        var currentWeek = 0;
        var currentYear = 
        firebase.database().ref('/Date').on("value", function(snapshot) {
              var yearType = snapshot.val();
              currentYear = yearType.Year;
              monthSet();
                  // ...
        });
        //var floor = $("#sel1").val();
        var floor = 1;
        var onFloor = 0;
        //alert("floor is (waiting) " + floor);
        var CA = [];
        var Months = [];
        
        function Month (name,days) {
            //this.type = type;
            this.name = name;
            this.days = days;
        }
        function monthSet(){
            for(var i0 = 0;i0 < 12;i0++){
                if(i0 == 0){
                    Months.push(new Month('August',31));
                }
                else if(i0 == 1){
                    Months.push(new Month('September',30));
                }
                else if(i0 == 2){
                    Months.push(new Month('October',31));
                }
                else if(i0 == 3){
                    Months.push(new Month('November',30));
                }
                else if(i0 == 4){
                    Months.push(new Month('December',31));
                }
                else if(i0 == 5){
                    Months.push(new Month('January',31));
                }
                else if(i0 == 6){
                    if(currentYear == 0){
                        Months.push(new Month('February',29));
                    }
                    else{
                        Months.push(new Month('February',28));
                    }
                }
                else if(i0 == 7){
                    Months.push(new Month('March',31));
                }
                else if(i0 == 8){
                    Months.push(new Month('April',30));
                }
                else if(i0 == 9){
                    Months.push(new Month('May',31));
                }
                else if(i0 == 10){
                    Months.push(new Month('June',30));
                }
                else if(i0 == 11){
                    Months.push(new Month('July',31));
                }
            }
        }
        function Cell (num,specific) {
            this.num = num;
            this.specific = [];
            
        }
        
        for(var rr = 0;rr < 5;rr++){
             CA[rr] = [];
             for(var r = 0;r < 4;r++){
                 CA[rr][r] = new Cell();
                 CA[rr][r].num = 0;
                    //console.log("here's your stupid number " + CA[rr][r]);
             }
         }
        function clearCA(){
            for(var rr = 0;rr < 5;rr++){
                //CA[rr] = [];
                for(var r = 0;r < 4;r++){
                    CA[rr][r].num = 0;
                    //mineArray[rr][r] = 0;
                    console.log("here's your stupid number " + CA[rr][r].num);
                }
            }
        }
        function clearMine(){
            for(var rr = 0;rr < 5;rr++){
                //CA[rr] = [];
                for(var r = 0;r < 4;r++){
                    //CA[rr][r].num = 0;
                    mineArray[rr][r] = 0;
                    //console.log("here's your stupid number " + CA[rr][r].num);
                }
            }
        }
        function arrayClearCA(){
           // alert("in arrayClearCA");
            for(var rr = 0;rr < 5;rr++){
                //CA[rr] = [];
                for(var r = 0;r < 4;r++){
                    CA[rr][r].specific = [];
                    //console.log("here's your stupid number " + CA[rr][r].num);
                }
            }
            read(0,0);
            //alert("CA " + CA[0][0].specific[0]);
        }
        $( "#sel1" ).change(function() {
         // alert( "Handler for .change() called." );
          floor = $("#sel1").val();
          alert("floor now " + floor );
          //getNum();
          already = 0;
          arrayClearCA();
          ClearTable(4)  
          //beginAll();
        });
        function DropDown(newFloor){
          //floor = $("#sel1").val();
          floor = newFloor;
          alert("floor now " + floor );
          $("#floorName").text("Floor " + floor);
          //getNum();
          already = 0;
          //clearMine();
          arrayClearCA();
          ClearTable(4)  
        }
       // availability goes [day][period]
        function mineView(){
            
                mineMode = !mineMode;
                already = 0;
                //clearMine();
                arrayClearCA();
                ClearTable(4);
                getNum();
            
        }
        function actualAdd(qq,qqq,tempcart,q1,tempMonth,tempDay)
        {
            firebase.database().ref('/weeks/'+qq+'/floors/'+qqq+'/carts/' + tempcart+'/availability/'+q1).set({
                day: tempDay,
                month: Months[tempMonth].name,             
                0: "true",
                1: "true",
                2: "true",
                3: "true",
                //4: "true"

                });
        }
        function newRoom(){
            var room = $("#srch-term").val();
            console.log("room " + room);
            var user = firebase.auth().currentUser;
            if (user) {
                //firebase.database().ref('/users/'+user.uid).set({
                var updates = {};
                console.log("UID " + user.uid);
                updates['/users/'+user.uid +'/room'] = room;
                firebase.database().ref().update(updates);
                //4: "true"

            }
              // User is signed in.
            else {
                console.log("infinite sadness");
              // No user is signed in.
            }
            
            
        }
        function getCurrent(clicked, time){
            var weekRef = firebase.database().ref("/Date");
            var adjustDate;
            var adjustDay;
            var upMonth;
            weekRef.on("value", function(snapshot) {
              //alert(username);
                //var currentTemp  = 0;
                if(clicked == 0){
                    var tempDate = new Date();
                    var collect = snapshot.val();
                    currentDay = collect.Day;
                    currentMonth = collect.MonthNum;
                    currentWeek = collect.Week;
                    console.log("potato spider " + tempDate.getDate());
                    firstGet = true;
                    if(tempDate.getDay() == 0){
                        adjustDay = tempDate.getDay() + 1;
                        adjustDate = tempDate.getDate() + 1;
                    }
                    else if(tempDate.getDay() == 6){
                        adjustDay = tempDate.getDay() - 1;
                        adjustDate = tempDate.getDate() - 1;
                    } 
                    else{
                        console.log("in normal adjust");
                        adjustDay = tempDate.getDay();
                        adjustDate = tempDate.getDate();
                        console.log("adjust is " + adjustDate);
                    
                    }
                    console.log("XOX " + adjustDate + " " + adjustDay);
                    if(currentDay != adjustDate){
                        upday(adjustDate,adjustDay);
                    }
                }
                if(clicked == 0){
                    decorate();
                }
                else if(clicked == 1){
                    if(time == 1){
                        currentWeek++;
                        if((currentDay + 7) > Months[currentMonth].days){
                            currentDay = ((currentDay + 7) - Months[currentMonth].days);
                            if(currentMonth < 11){
                                currentMonth += 1;
                            }
                            else if(currentMonth == 11){
                                currentMonth = 0;
                            }
                        }
                        else{
                            currentDay = currentDay + 7;
                            console.log("halloween " + currentDay);
                        }
                    }
                    if(time == -1){
                        currentWeek--;
                        console.log("the most important day " + currentDay);
                        if((currentDay - 7) <= 0){
                            currentDay = Months[currentMonth - 1].days + (currentDay - 7);
                            if(currentMonth > 0){
                                currentMonth -= 1;
                            }
                            else if(currentMonth == 0){
                                currentMonth = 12;
                            }
                        }
                        else{
                            currentDay = currentDay - 7;
                            
                        }
                    }
                    console.log("current spider week is " + currentWeek);
                    console.log("current spider day is " + currentDay);
                    console.log("current spider month is " + currentMonth);
                    decorate();
                    //getNum();
                    already = 0;
                    arrayClearCA();
                    ClearTable(4)
                    //clearMine();
                    getNum();
                }
                
                //alert(currentWeek);
              // ...
            });
        }
        function timeTravel(){
            
        }
        function upday(newDay, relDay){
            //newDay is of the month
            //relDay is of the week
            var upWeek = 0;
            var upMonth = 0;
            if(relDay == 0){
                console.log("david pumpkins");
                if(currentWeek < 51){
                    upWeek = (currentWeek + 1);
                    console.log("david pumpkins 2");
                }
                else{
                    upWeek = (0);
                }
            }
            else{
                upWeek = currentWeek;
            }
            if(newDay == 1){
                console.log("situation");
                if(currentMonth < 11){
                    console.log("current before " + currentMonth);
                    currentMonth = currentMonth + 1;
                    upMonth = (currentMonth);
                    console.log("current after " + currentMonth);
                }
                else{
                    upMonth = (0);
                    currentMonth = 0;
                    if(currentYear < 4){
                        currentYear++;
                    }
                    else{
                        currentYear = 0;
                        
                    }
                    make52();
                }
            }
            else{
                upMonth = currentMonth;
            }
            console.log("New day " + newDay);
            console.log("upMonth " + upMonth);
            console.log("upWeek " + upWeek);
            console.log("month " + Months[upMonth].name);
            firebase.database().ref('/Date').set({
                Day: newDay,
                MonthNum: upMonth,
                Week: upWeek,
                Leap: "true",
                Month: Months[upMonth].name,
                Year:  currentYear
            });
            
            
        }
        function decorate(){
            tempDate = new Date();
            console.log("day " + tempDate.getDay());
            var chosenDay = tempDate.getDay();
            if(chosenDay == 6){
                chosenDay = 5;
            }
            else if(chosenDay == 0){
                chosenDay = 1;
            }
            var fillTemp;
            
            fillTemp = (currentDay - chosenDay + 1);
            if((currentDay - chosenDay + 1) <= 0){
                fillTemp = (Months[currentMonth - 1].days + fillTemp);
                //$("#monday").text("Monday " + ); 
            }
            else if((currentDay - chosenDay + 1) > Months[currentMonth].days){
                fillTemp = ((currentDay - chosenDay + 1) - Months[currentMonth].days);
            }
            $("#monday").text("Monday " +  (fillTemp));
            fillTemp = (currentDay - chosenDay + 2);
            if(fillTemp <= 0){
                fillTemp = (Months[currentMonth - 1].days + fillTemp);
                //$("#monday").text("Monday " + ); 
            }
            else if((currentDay - chosenDay + 2) > Months[currentMonth].days){
                fillTemp = ((currentDay - chosenDay + 2) - Months[currentMonth].days);
            }
            $("#tuesday").text("Tuesday " + (fillTemp));
            
            fillTemp = (currentDay - chosenDay + 3);
            if(fillTemp <= 0){
                fillTemp = (Months[currentMonth - 1].days + fillTemp);
                //$("#monday").text("Monday " + ); 
            }
            else if((currentDay - chosenDay + 3) > Months[currentMonth].days){
                fillTemp = ((currentDay - chosenDay + 3) - Months[currentMonth].days);
            }
            $("#wednesday").text("Wednesday " + (fillTemp));
            
            fillTemp = (currentDay - chosenDay + 4);
            if(fillTemp <= 0){
                fillTemp = (Months[currentMonth - 1].days + fillTemp);
                //$("#monday").text("Monday " + ); 
            }
            else if((currentDay - chosenDay + 4) > Months[currentMonth].days){
                fillTemp = ((currentDay - chosenDay + 4) - Months[currentMonth].days);
            }
            $("#thursday").text("Thursday " + (fillTemp));
            
            fillTemp = (currentDay - chosenDay + 5);
            if(fillTemp <= 0){
                fillTemp = (Months[currentMonth - 1].days + fillTemp);
                //$("#monday").text("Monday " + ); 
            }
            else if((currentDay - chosenDay + 5) > Months[currentMonth].days){
                fillTemp = ((currentDay - chosenDay + 5) - Months[currentMonth].days);
            }
            $("#friday").text("Friday " + (fillTemp));
            
            $("#MonthSlot").text(Months[currentMonth].name);
            //var dayRef = firebase.database().ref("/weeks/" + currentWeek + "/floors);
        }
        function make52(){
            var tempMonth = 0;
            var tempDay = 29;
            for(var qq = 0;qq < 52;qq++){//weeks
                for(var q1 = 0;q1 < 5;q1++){//days
                    var until = 0;
                    console.log("qq " + qq + " qqq " + qqq);
                    /*if(qqq == 3){
                        until = 4;
                        
                    }
                    else{
                        until = 2;
                    }*/
                    until = 2;
                    //var initialDay = tempDay;
                    //var initialMonth = tempMonth;
                    for(var qqq = 1; qqq < 4; qqq++){//floors
                        for(var q0 = 0;q0 < until;q0++){//carts
                            
                            /*if(Months[currentMonth].days != currentDate){
                                currentDate++;
                            }
                            else{
                                currentDate = 0;
                                currentMonth++;
                            }*/
                            //qq is week
                            
                            var tempcart = "cart" + q0.toString();
                            actualAdd(qq,qqq,tempcart,q1,tempMonth,tempDay);
                            //tempDay++;
                            
                        }
                        
                    }
                    if(Months[tempMonth].days != tempDay){
                        tempDay++;
                    }
                    else{
                        tempDay = 1;
                        if(tempMonth == 11){
                            //tempMonth++;
                            tempMonth == 0;
                        }
                        else{
                            tempMonth++;
                        }
                    }
                }
               // for(qqq = 1;qqq < 4;qqq){
                    //var localRef = firebase.database().ref("weeks/carts/floors/" + qqq);
                    /*localRef.on("value", function(snapshot) {
                        snapshot.forEach(function(childSnapshot) {
                            var id = childSnapshot.key;
                            for(var qqqq = 0;qqqq < 4;qqqq++){
                                firebase.database().ref('/weeks/carts/floors/' + qqq + '/' + id + '/availability/' + qqqq).set({
                                    0: "true",
                                    1: "true",
                                    2: "true",
                                    3: "true",
                                    4: "true"
                                    
                                });
                            }
                        });
                    });*/
                    
                     
                //}
                //adding two days to account for saturday and sunday. 
                /*if(Months[tempMonth].days != tempDay){
                    tempDay++;
                }*/
                //Months
                /*if((Months[tempMonth].days - 1) == tempDay){
                    tempDay = 2;
                    //tempMonth++;
                    if(tempMonth == 11){
                        //tempMonth++;
                        tempMonth == 0;
                    }
                    else{
                        tempMonth++;
                    }
                    
                }*/
                if((Months[tempMonth].days - 1) == tempDay){
                    tempDay = 1;
                    //tempMonth++;
                    if(tempMonth == 11){
                        //tempMonth++;
                        tempMonth == 0;
                    }
                    else{
                        tempMonth++;
                    }
                }
                else if(Months[tempMonth].days == tempDay){
                    tempDay = 2;
                    //tempMonth++;
                    if(tempMonth == 11){
                        //tempMonth++;
                        tempMonth == 0;
                    }
                    else{
                        tempMonth++;
                    }
                }
                else{
                    tempDay += 2;
                }
             }
        }
        function getNum(){
            console.log("it aLL starts here");
            
            //floor = $("#sel1").val();
            //alert("in get num " + floor);
            var floorCarts;
            console.log("current week potato " + currentWeek);
            var floorRef = firebase.database().ref("/weeks/"+currentWeek+"/floors/" + floor+"/carts");
            floorRef.on("value", function(snapshot) {
               floorCarts = snapshot.numChildren();
                //alert(floorCarts);
                onFloor = floorCarts;
                
                if(onFloor != 0){
                   // alert("onFloor " + onFloor);
                    //callLock = 0;
                    beginAll();
                }
            });
        }
        getNum();
        function beginAll(){
            console.log("in begin all");
            var Ref = firebase.database().ref();
            Ref.on("value", function(snapshot) {
                  var reset = snapshot.val();
                  //var started = sessionStorage.getItem('start');
                  //alert("Been set " + reset.beenSet);
                   if(reset.beenSet === "false"){
                       var updates = {};
                       updates['/beenSet'] = "true";
                       firebase.database().ref().update(updates);
                       //refill();
                       FEF();
                       
                       /*firebase.database().ref().set({
                           beenSet = "true"
                       });*/
                       if(already === 0){
                           already = 1;
                           startFunc();
                       }
                   }
                   //alert("alert " + already);
                   if(already === 0){
                       // Save data to sessionStorage
                       //sessionStorage.setItem('key', 1);
                       already = 1;
                       startFunc();
                   }
            });
            //calendar();
        }
        var UID = sessionStorage.getItem('UID');
        function signOut(){
            firebase.auth().signOut().then(function() {
              // Sign-out successful.
                //alert("yo signing out");
                window.location.href="index.html";
            }, function(error) {
              // An error happened.
            });
        }
        function FEF(){
            console.log("in FEF " );
                for(var current = 1;current < 4;current++){//floors
                    //for(var ww = 0;ww < 52;ww++){//weeks
                        console.log("ww is " + ww );
                        //alert(current);
                        refill(current)//,ww);
                        
                    //}
                }
        }
        //alert("UID " + UID);
        function refill(tempfloor){//,ww){
            console.log("in refill");
                var localRef = firebase.database().ref("/weeks/" + currentWeek + "/floors/" + tempfloor+"/carts");
                 localRef.on("value", function(snapshot) {
                     snapshot.forEach(function(childSnapshot) {//carts per floor
                          var CPF = snapshot.numChildren();
                          //alert("Carts per floor " + CPF);
                          //console.log("tempfloor " + tempfloor + " ww " + ww);
                          // key will be "ada" the first time and "alan" the second time
                          var key = childSnapshot.key;
                          //alert("key is " + key);
                          // childData will be the actual contents of the child
                          var childData = childSnapshot.val();
                          //weekCount(function(ww) {
                              for(var w = 0;w < 4;w++){//periods
                                  //console.log("w " + w);
                                  firebase.database().ref('/weeks/' + currentWeek + '/floors/' + tempfloor + '/carts/' + key + "/availability/" + w.toString()).set({
                                        0: "true",
                                        1: "true",
                                        2: "true",
                                        3: "true",
                                        4: "true"
                                   });
                               }
                          //});
                          
                          //weekCount(tempfloor,key,outerSet,callback);
                          
                      });
                  });
             //for(var n = 0;n < 6;n++){
                 /*var cartLink;
                 //var floor;
                 if(n === 0){
                     cartLink = "cart0";
                     floor = '1';
                 }
                 else if(n === 1){
                     cartLink = "cart1";
                     floor = '1';
                 }
                 else if(n === 2){
                     cartLink = "cart0";
                     floor = '2';
                 }
                 else if(n === 3){
                     cartLink = "cart1";
                     floor = '2';
                 }
                 else if(n === 4){
                     cartLink = "cart0";
                     floor = '3';
                 }
                 else if(n === 5){
                     cartLink = "cart1";
                     floor = '3';
                 }*/
                 /*for(var w = 0;w < 4;w++){
                     firebase.database().ref('/carts/floors/' + floor + '/' + cartLink + "/availability/" + w.toString()).set({
                        0: "true",
                        1: "true",
                        2: "true",
                        3: "true",
                        4: "true"
                      });
                 }*/
                 //Fill(cartLink,floor,addFloor);
                 
             //}
            //alert("calling");
            //startFunc();
        }
        /*function weekCount(callback){
            console.log("in week count");
            for(var ww = 0; ww < 52;ww++){
               console.log("ww is " + ww);
                callback(ww);
               //outerSet(ww,tempfloor,key);
            }
        }*/
       /* function Fill(cartLink,floor,callback){
            for(var w = 0;w < 4;w++){
                     firebase.database().ref('/carts/' + cartLink + "/availability/" + w.toString()).set({
                        one: "true",
                        two: "true",
                        three: "true",
                        four: "true",
                        five: "true"
                      });
                 }
            //callback(cartLink,floor);
        }*/
        /*function addFloor(cartLink,floor){
            firebase.database().ref("/carts/" + cartLink).set({
                 floor: floor
            });
        }*/
        var mineArray = [];
        var taken = [];
        var selected = [];
        for(var p = 0;p < 5;p++){
            taken[p] = [];
            mineArray[p] = [];
        }
        function Clickable (numID, color,yesList) {
            this.numID = numID;
            //this.yesList = [];
            
        }
        //startFunc();
        function startFunc(){
            var j = 0;
            var k = 0;
            //var dfd = $.Deferred();
            alert("in startFunc() " + onFloor);
            for(var k = 0;k < 5;k++){
                for(j = 0;j < 4;j++){
                    for(var x = 0;x < onFloor;x++){

                        checkAvailable(j,k,x);
                        //var temp = Math.floor((Math.random() * 2));
                        //console.log("temp "+temp);
                        console.log("really " + j +"what " + k);


                    }
                }
            }
        }
        function checkAvailable(j,k,x){
            //alert("checking availability");
            //alert("checkAvailable of " + x);
            //j is period, k is day
            //x is cart
            var specificCarts = [];
            //here is the error
            //var tempX = x + (floor - 1) * 2;
            //console.log("temp X " + tempX);
            var cartVal = "cart" + x.toString();
            //console.log("here's your val " + cartVal);
            var kVal = 0;
            if(k == 0){
                //kVal = "one";
                kVal = '0';
            }
            else if(k == 1){
                //kVal = "two";
                kVal = '1';
            }
            else if(k == 2){
               // kVal = "three";
                kVal = '2';
            }
            else if(k == 3){
                //kVal = "four";
                kVal = '3';
            }
            else if(k == 4){
                //kVal = "five";
                kVal = '4';
            }
            //console.log("kVal " + kVal);
            //j is period
            var freeCarts = false;
            var numAvail = 0;
                var cartsRef = firebase.database().ref("/weeks/" + currentWeek + "/floors/" + floor + '/carts/' + cartVal + "/availability/"+ kVal + "/" + j);
                cartsRef.on("value", function(snapshot) {
                    var available = snapshot.val()
                    
                    //console.log("availability " + available + " cartVal " + cartVal + " day " + kVal + " period " + j);
                    if(available == "true"){
                        //console.log("yo12");
                        if(cartVal == "cart2");
                        freeCarts = true;
                    }
                    else if(available != "true"){
                        if(available == personalRoom){
                            mineArray[kVal][j] = 1;
                        }
                        freeCarts = false;
                    }
                    //console.log("potato " + x + " row " + j + " col " + k);
                    if((x == 2) && (j == 0) && (kVal == "one")){
                        alert("hey "  + freeCarts);
                    }
                    if(freeCarts == true){
                        //console.log(tempX);
                        //console.log("we are about to say yes");
                        //taken[j][k] = "yes";
                       // console.log("before " + CA[k][j].num);
                        var temp = CA[k][j].num;
                       // console.log("temp is " + temp);
                        CA[k][j].num = (temp + 1);
                       // console.log("after " + CA[k][j].num);
                        //console.log("spiders " + x + " row " + j + " col " + k);
                        CA[k][j].specific.push(x);
                        //taken[j][k] += 1;
                        //alert("say yes");
                    }
                    else if(freeCarts == false){
                        //taken[j][k] = "no";
                        console.log("say no");
                    }
                   /* if(x === 5){
                        alert("done for this round");
                        CA[x][j].specific = specificCarts;
                    }*/
                    //console.log("j" + j);
                    //console.log("k" + k);
                    //console.log("count" + count);
                    //console.log("numcarts" + numCarts);
                    if((j === 3) && (k === 4) && (x === (onFloor - 1))){
                           alert("go again mate");
                            console.log(callLock + " callLock");
                           if(callLock == 0){
                               callLock = 1;
                               console.log("WE ARE MAKING A CALL");
                               account();
                           }
                           //myFunction();
                     }
                    /*var numCarts = snapshot.numChildren();
                    var count = 0;
                  // The callback function will get called twice, once for "fred" and once for "barney"
                    //console.log("in cartsref");
                    snapshot.forEach(function(childSnapshot) {
                    count++;
                   // console.log("per cart");
                    // key will be "fred" the first time and "barney" the second time
                    //var key = childSnapshot.key();
                    // childData will be the actual contents of the child
                    var available = childSnapshot.val();
                    //var available = childData.
                    //var available = childData.availability.child(kVal).val();
                    console.log("availability " + available);
                    if(available == "true"){
                        console.log("yo12");
                        freeCarts = true;
                    }
                    else if(available == "false"){
                        freeCarts = false;
                    }
                        
                    if(freeCarts == true){
                        //console.log("we are about to say yes");
                        taken[j][k] = "yes";
                        alert("say yes");
                    }
                    else if(freeCarts == false){
                        taken[j][k] = "no";
                        console.log("say no");
                    }
                    console.log("j" + j);
                    console.log("k" + k);
                    console.log("count" + count);
                    console.log("numcarts" + numCarts);
                    if((j === 3) && (k === 4) && (count === numCarts)){
                            alert("go again mate");
                           console.log("WE ARE MAKING A CALL");
                           myFunction();
                     }
                  });*/
                    
                });
        }
        function account(){
            alert("in account");
            for(var ii = 0;ii < 5;ii++){
                for(var jj = 0;jj < 4;jj++){
                   // alert("availability CA " + CA[ii][jj]);
                    if(CA[ii][jj].num !== 0){
                        taken[ii][jj] = "yes";
                    }
                    else{
                        taken[ii][jj] = "no";
                    }
                }
            }
            clearCA();
            myFunction();
            
        }
        /*function calendar(){
            alert("calendar");
            //need the start date from firebase at this point
            var startDate = new Date(116, 8, 29); //temporary starting date until then
            
            var week;
            var day;
            //ok now get week from firebase
            var weekNumber = firebase.database().ref("/Date");
            weekNumber.on("value", function(snapshot) {
                var info1 = snapshot.val();
                week = info1.Week;
            });
            
            var firstDayOfWeek = firebase.database().ref("/weeks/" + week+ "/floors/1/carts/cart0/availability/0")
            firstDayOfWeek.on("value", function(snapshot) {
                var info2 = snapshot.val();
                //alert(info2.day);
                day = info2.day;
                
            });
            alert(week);
            alert(day);
        }*/
        //myFunction fills in table;
        function myFunction(){
            alert("adding rows to tables");
            var clicked = 0;
            //console.log("yoyoy");
            for(var i = 0;i < 4;i++){
                console.log("mineMode " + mineMode);
                if((mineArray[0][i] != 1) || (mineMode === false)){
                    var one = taken[0][i];
                }
                else{
                    if(taken[0][i] == "no"){
                    var one = "mineTaken";
                    }
                    else{
                    var one = "mine";
                    }
                }
                if((mineArray[1][i] != 1) || (mineMode === false)){
                    var two = taken[1][i];
                    //var two = "mine";
                }
                else{
                    if(taken[1][i] == "no"){
                    var two = "mineTaken";
                    }
                    else{
                    var two = "mine";
                    }
                }
                if((mineArray[2][i] != 1) || (mineMode === false)){    
                    var three = taken[2][i];
                    //var three = "mine";
                }
                else{
                    if(taken[2][i] == "no"){
                    var three = "mineTaken";
                    }
                    else{
                    var three = "mine";
                    }
                }
                if((mineArray[3][i] != 1) || (mineMode === false)){
                    var four = taken[3][i];
                    //var four = "mine";
                }
                else{
                    if(taken[3][i] == "no"){
                    var four = "mineTaken";
                    }
                    else{
                    var four = "mine";
                    }
                }
                if((mineArray[4][i] != 1) || (mineMode === false)){
                var five = taken[4][i];
                    //var five = "mine";
                }
                else{
                    if(taken[4][i] == "no"){
                    var five = "mineTaken";
                    }
                    else{
                    var five = "mine";
                    }
                }
                //clearMine();
                clicked++;
                $('#myTable tr:last').after('<tr><td>'+(i+1)+'</td><td class=' + one +'  id= '+(1+i*5).toString()+'></td><td class=' + two +' id= '+(2+i*5).toString()+'></td><td class=' + three +' id= '+(3+i*5).toString()+'></td><td class=' + four +' id= '+(4+i*5).toString()+'></td><td class=' + five +' id=  '+(5+i*5).toString()+'></td></tr>'); 
            }
            clearMine();
            //$('#myTable tr:last').remove();
        }
        $(document).ready(function() {
            $("table").click(function(event) {
                //alert(event.target.id);
                var ID = event.target.id;
                var Color = $('#'+ID).attr("class");
                var tempLocation = selected.indexOf(ID);
                console.log("color " + Color);
                if((Color === 'yes') || (Color == 'mine')){
                    console.log("HEY SPIDER " + selected.indexOf(ID));
                    if(selected.indexOf(ID) == -1){
                        console.log("this is new");
                        $('#'+ID).css('background-color','gold');
                        $('#'+ID).css('color','black');
                        selected.push(ID);
                    }
                    else{
                        if(Color == 'yes'){
                            $('#'+ID).css('background-color','#00ccff');
                        }
                        else if(Color == 'mine'){
                            $('#'+ID).css('background-color','lightpink');
                        }
                        readSelected();
                        selected.splice(tempLocation,1);
                        readSelected();
                    }
                   // selected.push(new Clickable(ID,Color));
                    
                }
            });
        });
        function readSelected(){
            for(var q = 0; q < selected.length;q++){
                console.log("mango " + selected[q]);
            }
        }
        function Clear(){//called when the submit button is clicked
            alert("submit function called");
            console.log("Submitting");
            for(var q = 0;q < selected.length;q++){
               // console.log("rawr" + selected.length);
                var tagOne;
                var tagTwo;
                var tagThree;
                var tempTwo;
                var tempOne;
                var tempInt = parseInt(selected[q],10);
                
                //alert("wup");
                if((tempInt >= 1) && (tempInt <= 5)){
                    tagOne = '0';
                    tagTwo = tempInt ;
                    tempOne = 0;
                }
                else if((tempInt  >= 6) && (tempInt <= 10)){
                    tagOne = '1';
                    tagTwo = tempInt  - 5;
                    tempOne = 1;
                }
                else if((tempInt  >= 11) && (tempInt  <= 15)){
                    tagOne = '2';
                    tagTwo = tempInt  - 10;
                    tempOne = 2;
                }
                else if((tempInt >= 16) && (tempInt  <= 20)){
                    tagOne = '3';
                    tagTwo = tempInt - 15;
                    tempOne = 3;
                }
                
                if(tagTwo === 1){
                    tagTwo = "0";
                    tempTwo = 0;
                }
                else if(tagTwo === 2){
                    tagTwo = "1";
                    tempTwo = 1;
                }
                else if(tagTwo === 3){
                    tagTwo = "2";
                    tempTwo = 2;
                }
                else if(tagTwo === 4){
                    tagTwo = "3";
                    tempTwo = 3;
                }
                else if(tagTwo === 5){
                    tagTwo = "4";
                    tempTwo = 4;
                }
                //tempTwo is days
                //tempOne is periods
                
                //alert(tagOne);
                //alert("tagTwo " + tagTwo);
                //alert("tempOne " + tempOne + " tempTwo " + tempTwo);
                //alert("tagThree " + CA[tempTwo][tempOne].specific[0]);
                tagThree = CA[tempTwo][tempOne].specific[0];
                read(tempTwo,tempOne);
                newUpdate(tagOne, tagTwo, tagThree);
                 //var updates = {};
                  //updates['/carts/cart1/availability/' + tagOne + '/' + tagTwo] = "false";
                  //firebase.database().ref().update(updates);
                
                //console.log("x0x");
                if(selected[q].color === "no"){
                    $('#'+selected[q]).css('background-color','#0d1a26');
                    $('#'+selected[q]).css('color','white');
                }
                else{
                    $('#'+selected[q]).css('background-color','#00ccff');
                    $('#'+selected[q]).css('color','black');
                }
            }
            selected.length = 0;
            //console.log("here's where it went south");
            already = 0;
            arrayClearCA();
            ClearTable(4);
            //clearMine();
            //startFunc();
        }
        function newUpdate(tagOne, tagTwo, tagThree){
            alert("in updating function");
            console.log("updating firebase");
            //alert("cart "+tagThree);
            //console.log("cart "+tagThree);
            tagThree = "cart" + tagThree.toString();
            /*if(tagThree === 0){
                tagThree = "cart0";
            }
            else if(tagThree === 1){
                tagThree = "cart1";
            }
            else if(tagThree === 2){
                tagThree = "cart2";
            }
            else if(tagThree === 3){
                tagThree = "cart3";
            }
            else if(tagThree === 4){
                tagThree = "cart4";
            }
            else if(tagThree === 5){
                tagThree = "cart5";
            }*/
            alert("cart "+ tagThree);
            var updates = {};
            //alert("floor now " + floor);
            updates['/weeks/' + currentWeek + '/floors/'+ floor + '/carts/' + tagThree+'/availability/' + tagTwo + '/' + tagOne] = personalRoom;
            firebase.database().ref().update(updates);
        }
        function read(k,j){
            alert("clearing the list of available");
            var temp = CA[k][j].specific.length;
            for(var iii = 0;iii < temp;iii++){
                //console.log("panda " + CA[k][j].specific[iii]);
            }
        }
        function ClearTable(until){
            console.log("deleting rows");
            alert("deleting the rows of tables");
            for(var t = 0; t < until;t++){
                //console.log("trying to clear here");
                $('#myTable tr:last').remove();
                if(t == (until - 1)){
                    console.log("done removing");
                    if(already === 0){
                        alert("ready to beginAll");
                        callLock = 0;
                        //already = 1;
                        //beginAll();
                        getNum();
                    }
                }
            }
            
        }
    </script>
    </body>
</html>
